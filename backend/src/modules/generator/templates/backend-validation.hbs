const Joi = require('joi');

const {{dashToCamel modulePath}}Validation = {
  // 获取{{description}}列表
  get{{moduleName}}s: {
    query: Joi.object({
      page: Joi.number().integer().min(1).default(1),
      limit: Joi.number().integer().min(1).max(100).default(10),
      {{#each searchFields}}
      {{#if (eq this.searchType 'range')}}
      {{this.name}}_start: Joi.{{this.joiType}}().optional().allow(''),
      {{this.name}}_end: Joi.{{this.joiType}}().optional().allow(''),
      {{else}}
      {{this.name}}: Joi.{{this.joiType}}().optional().allow(''),
      {{/if}}
      {{/each}}
      sort: Joi.string().optional(),
      order: Joi.string().valid('ASC', 'DESC').optional(),
    }),
  },

  // 获取{{description}}详情
  get{{moduleName}}ById: {
    params: Joi.object({
      id: Joi.string().uuid().required(),
    }),
  },

  {{#if enableCreate}}
  // 创建{{description}}
  create{{moduleName}}: {
    body: Joi.object({
      {{#each formFields}}
      {{#if this.required}}
      {{this.name}}: Joi.{{this.joiType}}(){{#if this.maxLength}}.max({{this.maxLength}}){{/if}}.required().messages({
        'any.required': '{{this.comment}}不能为空',
        {{#if this.maxLength}}'string.max': '{{this.comment}}长度不能超过{{this.maxLength}}',{{/if}}
      }),
      {{else}}
      {{this.name}}: Joi.{{this.joiType}}(){{#if this.maxLength}}.max({{this.maxLength}}){{/if}}.optional().allow(null, ''),
      {{/if}}
      {{/each}}
    }),
  },
  {{/if}}

  {{#if enableUpdate}}
  // 更新{{description}}
  update{{moduleName}}: {
    params: Joi.object({
      id: Joi.string().uuid().required(),
    }),
    body: Joi.object({
      {{#each formFields}}
      {{#if this.readonly}}
      // {{this.comment}} (只读字段，不允许更新)
      {{else}}
      {{this.name}}: Joi.{{this.joiType}}(){{#if this.maxLength}}.max({{this.maxLength}}){{/if}}.optional().allow(null, ''),
      {{/if}}
      {{/each}}
    }),
  },
  {{/if}}

  {{#if enableDelete}}
  // 删除{{description}}
  delete{{moduleName}}: {
    params: Joi.object({
      id: Joi.string().uuid().required(),
    }),
  },
  {{/if}}

  {{#if enableBatchDelete}}
  // 批量删除{{description}}
  batchDelete{{moduleName}}s: {
    body: Joi.object({
      ids: Joi.array().items(Joi.string().uuid()).min(1).required().messages({
        'array.min': '请至少选择一条记录',
        'any.required': 'ids不能为空',
      }),
    }),
  },
  {{/if}}

  {{#if enableExport}}
  // 导出{{description}}数据
  export{{moduleName}}s: {
    query: Joi.object({
      {{#each searchFields}}
      {{#if (eq this.searchType 'range')}}
      {{this.name}}_start: Joi.{{this.joiType}}().optional(),
      {{this.name}}_end: Joi.{{this.joiType}}().optional(),
      {{else}}
      {{this.name}}: Joi.{{this.joiType}}().optional(),
      {{/if}}
      {{/each}}
    }),
  },
  {{/if}}
};

module.exports = {{dashToCamel modulePath}}Validation;
